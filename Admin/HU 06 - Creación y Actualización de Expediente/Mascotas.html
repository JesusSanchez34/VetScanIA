<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Pacientes - SafePet Admin</title>
    <!-- Favicon -->
    <link rel="icon" href="../img/logo.png" type="image/png">
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">
    <!-- Iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Estilos -->
    <link rel="stylesheet" href="../estilosadmin/estilosgenerales.css">
    <link rel="stylesheet" href="../estilosadmin/estilosmascotas.css">
</head>
<body class="admin-pets">
    <!-- Barra lateral -->
    <aside class="admin-sidebar">
        <div class="sidebar-header">
            <img src="../imagenes/logoVetScanAi.png" alt="SafePet Admin" class="admin-logo">
            <h2>VetScanIa <span>Admin</span></h2>
        </div>
        
        <div class="admin-profile-card">
            <div class="profile-image-container">
                <img id="admin-profile-pic" src="../imagenes/Admin_icon.png" alt="Admin Profile">
                <span class="online-status"></span>
            </div>
            <div class="profile-info">
                <h3 id="admin-name">Cargando...</h3>
                <p id="admin-email">admin@safepet.com</p>
                <p class="admin-role"><i class="fas fa-shield-alt"></i> Administrador</p>
            </div>
        </div>
        
        <nav class="admin-nav">
            <ul>
                <li>
                    <a href="dashboard.html">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="usuarios.html">
                        <i class="fas fa-users-cog"></i>
                        <span>Gestión de Usuarios</span>
                    </a>
                </li>
                <li class="active">
                    <a href="mascotas.html">
                        <i class="fas fa-paw"></i>
                        <span>Pacientes</span>
                        <span class="menu-badge" id="new-pets-badge">5</span>
                    </a>
                </li>
                <li>
                    <a href="citas.html">
                        <i class="fas fa-calendar-check"></i>
                        <span>Citas</span>
                    </a>
                </li>
                <li>
                    <a href="inventario.html">
                        <i class="fas fa-pills"></i>
                        <span>Inventario</span>
                    </a>
                </li>
                <li>
                    <a href="reportes.html">
                        <i class="fas fa-chart-line"></i>
                        <span>Reportes</span>
                    </a>
                </li>
                <li>
                    <a href="configuracion.html">
                        <i class="fas fa-cogs"></i>
                        <span>Configuración</span>
                    </a>
                </li>
                <li class="nav-divider"></li>
                <li>
                    <a href="#" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Cerrar Sesión</span>
                    </a>
                </li>
            </ul>
        </nav>
        
        <div class="sidebar-footer">
            <p>Versión 1.0.0</p>
            <p id="last-login">Último acceso: Cargando...</p>
        </div>
    </aside>

    <!-- Contenido principal -->
    <main class="admin-content">
        <!-- Barra superior -->
        <header class="admin-toolbar">
            <div class="page-title">
                <h1>Gestión de Pacientes</h1>
                <p>Registro y seguimiento médico de mascotas</p>
            </div>
            
            <div class="toolbar-actions">
                <div class="search-container">
                    <input type="text" id="pets-search" placeholder="Buscar pacientes...">
                    <button><i class="fas fa-search"></i></button>
                </div>
                
                <div class="notifications-dropdown">
                    <button class="notification-btn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </button>
                    <!-- Contenido de notificaciones -->
                </div>
                
                <div class="quick-actions">
                    <button class="quick-action-btn" id="new-pet-btn">
                        <i class="fas fa-plus"></i> Nuevo Paciente
                    </button>
                    <button class="quick-action-btn secondary" id="import-pets-btn">
                        <i class="fas fa-file-import"></i> Importar
                    </button>
                </div>
            </div>
        </header>

        <!-- Contenido de Pacientes -->
        <div class="pets-container">
            <!-- Filtros y controles -->
            <div class="pets-controls">
                <div class="view-options">
                    <button class="view-option active" data-view="all">
                        <i class="fas fa-list"></i> Todos
                    </button>
                    <button class="view-option" data-view="dogs">
                        <i class="fas fa-dog"></i> Perros
                    </button>
                    <button class="view-option" data-view="cats">
                        <i class="fas fa-cat"></i> Gatos
                    </button>
                    <button class="view-option" data-view="pending-vaccines">
                        <i class="fas fa-syringe"></i> Vacunas Pendientes
                    </button>
                    <button class="view-option" data-view="chronic">
                        <i class="fas fa-heartbeat"></i> Pacientes Crónicos
                    </button>
                </div>
                
                <div class="filters-container">
                    <div class="filter-group">
                        <label for="species-filter">Especie:</label>
                        <select id="species-filter">
                            <option value="all">Todas</option>
                            <option value="dog">Perro</option>
                            <option value="cat">Gato</option>
                            <option value="bird">Ave</option>
                            <option value="other">Otros</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="size-filter">Tamaño:</label>
                        <select id="size-filter">
                            <option value="all">Todos</option>
                            <option value="small">Pequeño</option>
                            <option value="medium">Mediano</option>
                            <option value="large">Grande</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="owner-filter">Dueño:</label>
                        <select id="owner-filter">
                            <option value="all">Todos</option>
                            <option value="owner1">Juan Pérez</option>
                            <option value="owner2">María Sánchez</option>
                        </select>
                    </div>
                    
                    <button class="clear-filters-btn">
                        <i class="fas fa-times"></i> Limpiar
                    </button>
                </div>
            </div>
            
            <!-- Resumen de pacientes -->
            <div class="pets-summary">
                <div class="summary-card">
                    <div class="summary-icon primary">
                        <i class="fas fa-paw"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Pacientes Totales</h3>
                        <p class="summary-number" id="total-pets">247</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="summary-icon success">
                        <i class="fas fa-dog"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Perros</h3>
                        <p class="summary-number" id="dogs-count">168</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="summary-icon info">
                        <i class="fas fa-cat"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Gatos</h3>
                        <p class="summary-number" id="cats-count">72</p>
                    </div>
                </div>
                
                <div class="summary-card">
                    <div class="summary-icon warning">
                        <i class="fas fa-syringe"></i>
                    </div>
                    <div class="summary-info">
                        <h3>Vacunas Pendientes</h3>
                        <p class="summary-number" id="pending-vaccines-count">34</p>
                    </div>
                </div>
            </div>
            
            <!-- Tarjetas de pacientes -->
            <div class="pets-grid" id="pets-grid-view">
                <!-- Vista de cuadrícula (tarjetas) -->
                <div class="pet-card">
                    <div class="pet-card-header">
                        <div class="pet-image">
                            <img src="../img/pet1.jpg" alt="Max">
                            <span class="pet-species dog"><i class="fas fa-dog"></i></span>
                        </div>
                        <h3>Max</h3>
                        <p class="pet-breed">Golden Retriever</p>
                    </div>
                    
                    <div class="pet-card-body">
                        <div class="pet-info-item">
                            <i class="fas fa-user"></i>
                            <span>Dueño: Juan Pérez</span>
                        </div>
                        <div class="pet-info-item">
                            <i class="fas fa-birthday-cake"></i>
                            <span>Edad: 3 años</span>
                        </div>
                        <div class="pet-info-item">
                            <i class="fas fa-venus-mars"></i>
                            <span>Sexo: Macho</span>
                        </div>
                        <div class="pet-info-item">
                            <i class="fas fa-weight"></i>
                            <span>Peso: 28 kg</span>
                        </div>
                    </div>
                    
                    <div class="pet-card-footer">
                        <div class="vaccine-status warning">
                            <i class="fas fa-exclamation-circle"></i>
                            <span>1 vacuna pendiente</span>
                        </div>
                        <div class="pet-actions">
                            <button class="action-btn view" title="Ver historial">
                                <i class="fas fa-history"></i>
                            </button>
                            <button class="action-btn edit" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn medical" title="Nuevo tratamiento">
                                <i class="fas fa-file-medical"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Más tarjetas de mascotas... -->
            </div>
            
            <!-- Tabla de pacientes (alternativa) -->
            <div class="pets-table-container hidden" id="pets-table-view">
                <div class="table-header">
                    <h2>Listado de Pacientes</h2>
                    <div class="table-actions">
                        <button class="table-action-btn" id="export-pets-btn">
                            <i class="fas fa-file-export"></i> Exportar
                        </button>
                        <button class="table-action-btn" id="switch-view-btn">
                            <i class="fas fa-th"></i> Vista de Tarjetas
                        </button>
                    </div>
                </div>
                
                <table class="pets-table">
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Especie</th>
                            <th>Raza</th>
                            <th>Dueño</th>
                            <th>Edad</th>
                            <th>Última Visita</th>
                            <th>Vacunas</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="pets-list">
                        <!-- Datos dinámicos de Firebase irán aquí -->
                        <tr>
                            <td>
                                <div class="pet-info">
                                    <div class="pet-image">
                                        <img src="../img/pet1.jpg" alt="Max">
                                    </div>
                                    <span>Max</span>
                                </div>
                            </td>
                            <td><span class="species-badge dog"><i class="fas fa-dog"></i> Perro</span></td>
                            <td>Golden Retriever</td>
                            <td>Juan Pérez</td>
                            <td>3 años</td>
                            <td>15/06/2023</td>
                            <td>
                                <div class="vaccine-info warning">
                                    <i class="fas fa-exclamation-circle"></i>
                                    <span>1 pendiente</span>
                                </div>
                            </td>
                            <td>
                                <div class="action-buttons">
                                    <button class="action-btn view" title="Ver historial">
                                        <i class="fas fa-history"></i>
                                    </button>
                                    <button class="action-btn edit" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="action-btn medical" title="Nuevo tratamiento">
                                        <i class="fas fa-file-medical"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <!-- Más filas... -->
                    </tbody>
                </table>
                
                <div class="table-footer">
                    <div class="pagination-controls">
                        <button class="pagination-btn" disabled>
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="page-info">Página 1 de 12</span>
                        <button class="pagination-btn">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Nuevo/Editar Paciente -->
    <div class="modal hidden" id="pet-modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="pet-modal-title">Nuevo Paciente</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <form id="pet-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pet-name">Nombre de la Mascota*</label>
                            <input type="text" id="pet-name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="pet-species">Especie*</label>
                            <select id="pet-species" required>
                                <option value="">Seleccionar especie...</option>
                                <option value="dog">Perro</option>
                                <option value="cat">Gato</option>
                                <option value="bird">Ave</option>
                                <option value="reptile">Reptil</option>
                                <option value="other">Otro</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pet-breed">Raza*</label>
                            <input type="text" id="pet-breed" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="pet-gender">Sexo*</label>
                            <select id="pet-gender" required>
                                <option value="">Seleccionar...</option>
                                <option value="male">Macho</option>
                                <option value="female">Hembra</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pet-birthdate">Fecha de Nacimiento (o edad aproximada)*</label>
                            <div class="date-age-selector">
                                <input type="date" id="pet-birthdate">
                                <span class="or-divider">o</span>
                                <div class="age-input">
                                    <input type="number" id="pet-age" min="0" max="30" placeholder="Edad">
                                    <select id="pet-age-unit">
                                        <option value="years">años</option>
                                        <option value="months">meses</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="pet-weight">Peso (kg)*</label>
                            <input type="number" id="pet-weight" min="0" step="0.1" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pet-color">Color*</label>
                            <input type="text" id="pet-color" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="pet-size">Tamaño*</label>
                            <select id="pet-size" required>
                                <option value="">Seleccionar...</option>
                                <option value="small">Pequeño</option>
                                <option value="medium">Mediano</option>
                                <option value="large">Grande</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="pet-owner">Dueño*</label>
                        <select id="pet-owner" required>
                            <option value="">Seleccionar dueño...</option>
                            <option value="owner1">Juan Pérez (juan@example.com)</option>
                            <option value="owner2">María Sánchez (maria@example.com)</option>
                        </select>
                        <button type="button" class="small-btn" id="add-new-owner-btn">
                            <i class="fas fa-plus"></i> Nuevo Dueño
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label for="pet-microchip">Microchip/Identificación</label>
                        <input type="text" id="pet-microchip">
                    </div>
                    
                    <div class="form-group">
                        <label for="pet-notes">Notas/Alertas Médicas</label>
                        <textarea id="pet-notes" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="pet-image">Foto de la Mascota</label>
                        <input type="file" id="pet-image" accept="image/*">
                        <div class="image-preview hidden" id="pet-image-preview">
                            <img id="pet-preview-image" src="#" alt="Vista previa de la mascota">
                            <button type="button" id="remove-pet-image-btn">
                                <i class="fas fa-times"></i> Eliminar foto
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button class="btn secondary close-modal-btn">Cancelar</button>
                <button class="btn primary" id="save-pet-btn">Guardar Paciente</button>
            </div>
        </div>
    </div>

    <!-- Modal para Historial Médico -->
    <div class="modal hidden" id="medical-history-modal">
        <div class="modal-content xlarge">
            <div class="modal-header">
                <h2 id="medical-history-title">Historial Médico de <span id="pet-history-name">Max</span></h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="modal-body">
                <div class="medical-history-container">
                    <div class="pet-summary-card">
                        <div class="pet-image-large">
                            <img src="../img/pet1.jpg" alt="Max">
                        </div>
                        <div class="pet-summary-info">
                            <h3>Max</h3>
                            <p class="pet-breed">Golden Retriever</p>
                            <div class="pet-details">
                                <p><i class="fas fa-venus-mars"></i> Macho, 3 años</p>
                                <p><i class="fas fa-weight"></i> 28 kg</p>
                                <p><i class="fas fa-user"></i> Dueño: Juan Pérez</p>
                                <p><i class="fas fa-microchip"></i> Microchip: 123456789012345</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="medical-tabs">
                        <button class="medical-tab active" data-tab="visits">
                            <i class="fas fa-calendar-check"></i> Visitas
                        </button>
                        <button class="medical-tab" data-tab="vaccines">
                            <i class="fas fa-syringe"></i> Vacunas
                        </button>
                        <button class="medical-tab" data-tab="treatments">
                            <i class="fas fa-pills"></i> Tratamientos
                        </button>
                        <button class="medical-tab" data-tab="allergies">
                            <i class="fas fa-allergies"></i> Alergias
                        </button>
                        <button class="medical-tab" data-tab="notes">
                            <i class="fas fa-notes-medical"></i> Notas
                        </button>
                    </div>
                    
                    <div class="medical-tab-content active" id="visits-tab">
                        <div class="medical-records">
                            <div class="medical-record">
                                <div class="record-date">
                                    <span class="record-day">15</span>
                                    <span class="record-month">Jun</span>
                                    <span class="record-year">2023</span>
                                </div>
                                <div class="record-details">
                                    <h3>Consulta de rutina</h3>
                                    <p class="record-vet"><i class="fas fa-user-md"></i> Dra. Gómez</p>
                                    <p class="record-diagnosis">Revisión anual. Peso estable. Se aplicó vacuna contra la rabia.</p>
                                    <div class="record-actions">
                                        <button class="action-btn view">
                                            <i class="fas fa-eye"></i> Ver detalles
                                        </button>
                                        <button class="action-btn print">
                                            <i class="fas fa-print"></i> Imprimir
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <!-- Más registros médicos... -->
                        </div>
                    </div>
                    
                    <div class="medical-tab-content" id="vaccines-tab">
                        <div class="vaccine-status">
                            <h3>Estado de Vacunación</h3>
                            <div class="vaccine-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                                <span class="progress-text">85% completo</span>
                            </div>
                        </div>
                        
                        <table class="vaccine-table">
                            <thead>
                                <tr>
                                    <th>Vacuna</th>
                                    <th>Fecha Aplicación</th>
                                    <th>Próxima Dosis</th>
                                    <th>Estado</th>
                                    <th>Veterinario</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Rabia</td>
                                    <td>15/06/2023</td>
                                    <td>15/06/2024</td>
                                    <td><span class="status-badge completed">Completa</span></td>
                                    <td>Dra. Gómez</td>
                                    <td>
                                        <button class="action-btn view">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                                <!-- Más filas de vacunas... -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Otras pestañas del historial médico... -->
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn secondary close-modal-btn">Cerrar</button>
                <button class="btn primary" id="new-medical-record-btn">
                    <i class="fas fa-plus"></i> Nuevo Registro
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <!-- Configuración Firebase -->
    <script src="../js/firebase-config.js"></script>
    
    <!-- Scripts del Admin -->
    <script src="../js/admin-auth.js"></script>
    <script src="../js/admin-pets.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Abrir modal de nuevo paciente
            const newPetBtn = document.getElementById('new-pet-btn');
            const petModal = document.getElementById('pet-modal');
            const closeModalBtns = document.querySelectorAll('.close-modal, .close-modal-btn');
            
            newPetBtn.addEventListener('click', function() {
                document.getElementById('pet-modal-title').textContent = 'Nuevo Paciente';
                petModal.classList.remove('hidden');
            });
            
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    petModal.classList.add('hidden');
                    document.getElementById('medical-history-modal').classList.add('hidden');
                });
            });
            
            // Vista previa de imagen de mascota
            const petImageInput = document.getElementById('pet-image');
            const petImagePreview = document.getElementById('pet-image-preview');
            const petPreviewImage = document.getElementById('pet-preview-image');
            const removePetImageBtn = document.getElementById('remove-pet-image-btn');
            
            petImageInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        petPreviewImage.src = event.target.result;
                        petImagePreview.classList.remove('hidden');
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            removePetImageBtn.addEventListener('click', function() {
                petImageInput.value = '';
                petPreviewImage.src = '#';
                petImagePreview.classList.add('hidden');
            });
            
            // Cambiar entre vista de tarjetas y tabla
            const switchViewBtn = document.getElementById('switch-view-btn');
            if (switchViewBtn) {
                switchViewBtn.addEventListener('click', function() {
                    document.getElementById('pets-grid-view').classList.toggle('hidden');
                    document.getElementById('pets-table-view').classList.toggle('hidden');
                    this.innerHTML = document.getElementById('pets-grid-view').classList.contains('hidden') ? 
                        '<i class="fas fa-th"></i> Vista de Tarjetas' : 
                        '<i class="fas fa-list"></i> Vista de Tabla';
                });
            }
            
            // Simular clic en botón de historial médico
            document.querySelectorAll('.action-btn.view').forEach(btn => {
                btn.addEventListener('click', function() {
                    const petName = this.closest('.pet-card') ? 
                        this.closest('.pet-card').querySelector('h3').textContent : 
                        this.closest('tr').querySelector('.pet-info span').textContent;
                    
                    document.getElementById('pet-history-name').textContent = petName;
                    document.getElementById('medical-history-modal').classList.remove('hidden');
                });
            });
            
            // Tabs del historial médico
            const medicalTabs = document.querySelectorAll('.medical-tab');
            medicalTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    medicalTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    const tabId = this.dataset.tab + '-tab';
                    document.querySelectorAll('.medical-tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(tabId).classList.add('active');
                });
            });
        });
    </script>
</body>
</html>